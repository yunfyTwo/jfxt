<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>登录</title>
    <link rel="stylesheet" href="css/weui.min.css">
    <link rel="stylesheet" href="css/jquery-weui.css">
    <link rel="stylesheet" href="css/demos.css">
    <script src="js/jquery-2.1.4.js"></script>
    <script src="js/fastclick.js"></script>
    <script src="js/zepto.min.js"></script>
    <script src="js/swipe.js"></script>
    <script src="js/common.js"></script>
</head>
<body ontouchstart>
    <div class="weui-cells weui-cells_form wcs" id="loginDiv">
        <div class="kong"></div>
        <div class="weui-cell wc">
            <img src="images/logo.png" alt="">
        </div>
        <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label"><img src="images/tuandui.png" width="35" height="35" /></label></div>
            <div class="weui-cell__bd">
                <input id='loginName'  class="weui-input" type="text"  placeholder="请输入用户名">
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label"><img src="images/gengduo.png" width="35" height="35" /></label></div>
            <div class="weui-cell__bd">
                <input id='password' class="weui-input" type="password"  placeholder="请输入密码">
            </div>
        </div>
        <div class="weui-cell dl">
            <input class="weui-btn weui-btn_primary" type="button" value="登录"  onclick="login()"/>
            <!--<input class="weui-btn weui-btn_primary"    href="index1.html" value="登录"/>-->
        </div>
    </div>
</body>

<script type="text/javascript"> 
	$(function(){
		$("#loginDiv").hide();
		var loginName = localStorage.getItem("loginName");		
		if(loginName){
            $.post(
                getContextPath()+"/app/getPermissions",
                {
                    "id": loginName
                },
                function (data) {
                    if(data.code == 1) {
                        var obj = data.data;
                        localStorage.removeItem("permissions");
                        localStorage.setItem("permissions",obj.permissions);
                        // $.toast(data.msg, 'forbidden', 8000);
                        $.toast(data.msg);
                        window.location.href = "index1.html";
                    } else {
                        $.toast("登录失效,请重新登录",'forbidden', 8000);
                        window.location.href = "index.html";
                    }
                });
		}
		$("#loginDiv").show();
	});

	function login() {

     var loginName = $("#loginName").val();
     var password = $("#password").val();
     if(loginName.length!=0 || password.length!=0){
         $.post(
             getContextPath()+"/app/toLogin",
             {
                 "loginName": loginName,
                 "password": password
             },
             function (data) {
                 if(data.code == 1) {
                     var obj = data.data;
                     localStorage.setItem("loginName",obj.id);
                     localStorage.removeItem("permissions");
                     localStorage.setItem("permissions",obj.permissions);
                     // $.toast(data.msg, 'forbidden', 8000);
                     $.toast(data.msg);
                     window.location.href = "index1.html";
                 } else {
                     $.toast(data.msg,'forbidden', 8000);
                 }
             });
     }else {
            alert("用户名或密码不能为空！");
     }
     }
// 	function login(){
// 		var loginName = $("#loginName").val();
//         var password = $("#password").val();
// 		$.ajax({
//                 type: "post",
//                 url: getContextPath()+"/api/jf/login",
//                 data:JSON.stringify(
//                     {
//                     'loginName': loginName,
//                     'password': password
//                     }
//                 ),
//                 dataType: "jsonp",
//                 contentType: "application/json",
//                 async:false,
//                 success: function(data){
//                     if(data.code == 1){
//                     	window.location.href = "index1.html";
//                     }
//                 }
//            });
// 	}
	 
	
    $(function() {
        FastClick.attach(document.body) ;
    });
</script>
<script src="js/jquery-weui.js"></script>
<script>
    $('.wcs').height($('body').height());
</script>
<script>
document.addEventListener('plusready', function(a) {
            var first = null;
            plus.key.addEventListener('backbutton', function() {
                    //首次按键，提示‘再按一次退出应用’
                    if (!first) {
                        first = new Date().getTime();
                        console.log('再按一次退出应用');//用自定义toast提示最好
                        setTimeout(function() {
                            first = null;
                        }, 1000);
                    } else {
                        if (new Date().getTime() - first < 1000) {
                            plus.runtime.quit();
                        }
                    }
                }, false);
        });
 </script>
</html>